<!DOCTYPE html>
<html lang="en"> <!-- 'dark' class will be added here by JS -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unblocked Game Hub</title>
    <!-- Favicon (will be changed by panic button) -->
    <link id="favicon" rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ®</text></svg>">
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!--
    CRITICAL: This config script MUST come after loading Tailwind
    It tells Tailwind how to handle dark mode.
    -->
    <script>
        tailwind.config = {
            darkMode: 'class', // This enables 'dark:' classes
            theme: {
                extend: {
                    // You can extend your theme here if needed
                }
            }
        }
    </script>
    <!-- Load Google Font (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <!-- Load Custom Stylesheet -->
    <link rel="stylesheet" href="style.css">
    
    <!-- AdSense Ad Feature Implementation -->
    <!-- client=ca-pub-1765603916015326 -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1765603916015326"
Â  Â  Â crossorigin="anonymous"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-gray-900 bg-opacity-75 backdrop-blur-sm">
        <div class="loader"></div>
        <p class="mt-4 text-lg font-semibold text-white">Connecting to Hub...</p>
    </div>
    
    <!-- App Wrapper (will be hidden on panic) -->
    <div id="appWrapper">
        <!-- Header -->
        <header class="sticky top-0 z-40 w-full bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm">
            <div class="container flex items-center justify-between h-16 px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
                <!-- Brand -->
                <div class="flex items-center gap-2">
                    <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-accent">
                        <i data-lucide="gamepad-2" class="w-5 h-5 text-white"></i>
                    </div>
                    <span class="text-xl font-bold text-gray-900 dark:text-white">Unblocked Game Hub</span>
                </div>
                
                <!-- Navigation -->
                <nav class="hidden md:flex md:items-center md:gap-2" id="desktopNav">
                    <!-- Nav buttons will be injected here -->
                </nav>
    
                <!-- Auth & Theme Toggle -->
                <div class="flex items-center gap-3">
                     <div id="authStatus" class="flex items-center gap-2 p-2 text-sm text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg">
                        <span class="font-medium">Status:</span>
                        <span id="authMessage">Initializing...</span>
                     </div>
                     <!-- NEW: Theme Toggle Button -->
                     <button id="themeToggle" class="p-2 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i data-lucide="sun" class="w-6 h-6"></i> <!-- Icon will be changed by JS -->
                     </button>
                     <!-- NEW: User Profile Button -->
                     <button id="userProfileButton" title="My Profile" class="flex items-center gap-2 p-2 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <span id="userProfileAvatar" class="text-xl">ðŸŽ®</span>
                        <span id="userProfileName" class="hidden text-sm font-semibold sm:block">Player</span>
                     </button>
                     <!-- NEW: Random Game Button -->
                     <button id="randomGameBtn" title="Play a random game" class="p-2 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i data-lucide="dice-5" class="w-6 h-6"></i>
                     </button>
                     <button id="mobileMenuButton" class="p-2 rounded-lg md:hidden text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                     </button>
                </div>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobileNav" class="hidden border-t border-gray-200 dark:border-gray-700 md:hidden bg-white dark:bg-gray-800">
                <div class="flex flex-col p-4 space-y-2">
                    <!-- Mobile nav buttons will be injected here -->
                </div>
            </div>
        </header>
    
        <!-- Main Content -->
        <main class="container p-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
            
            <!-- Home Page -->
            <section id="page-home" class="page">
                <div class="p-8 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-accent-light">
                    <h1 class="text-4xl font-bold text-gray-900 dark:text-white">Welcome to the Hub!</h1>
                    <p id="homeDesc" class="mt-3 text-lg text-gray-600 dark:text-gray-300">Loading description...</p>
                </div>
                
                <!-- NEW: Featured Game Section -->
                <div id="featuredGameContainer" class="mt-8">
                    <!-- Featured game will be injected here -->
                </div>

                <div class="mt-8"> <!-- Added margin-top -->
                     <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">Recently Played</h2>
                     <div id="recentlyPlayedGrid" class="grid grid-cols-1 gap-4 mt-4 md:grid-cols-3 lg:grid-cols-5">
                        <!-- Recently played games will be injected here -->
                     </div>
                </div>
            </section>
    
            <!-- NEW: Favorites Page -->
            <section id="page-favorites" class="page" style="display:none;">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">My Favorites</h2>
                <div id="favoritesSearchSortContainer" class="mt-4">
                    <!-- Search/sort bar will be injected here -->
                </div>
                <div id="favoritesGrid" class="grid grid-cols-1 gap-6 mt-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
                    <!-- Favorite games will be injected here -->
                </div>
            </section>
    
            <!-- Dynamic Game Section Pages -->
            <!-- A container for all game sections -->
            <div id="gameSectionsContainer">
                <!-- Dynamic pages will be injected here -->
            </div>

            <!-- NEW: All Tags Page -->
            <section id="page-tags" class="page" style="display:none;">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">All Tags</h2>
                <p class="mt-2 text-gray-600 dark:text-gray-400">Click a tag to filter games.</p>
                <div id="tagsPageGrid" class="flex flex-wrap gap-2 mt-4">
                    <!-- Tags will be injected here -->
                </div>
            </section>

            <!-- NEW: Admin Page -->
            <section id="page-admin" class="page" style="display:none;">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Admin Dashboard</h2>
                
                <!-- Admin Login -->
                <div id="adminLogin" class="p-6 mt-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg max-w-lg">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">Admin Login</h3>
                    <p class="mt-2 text-gray-600 dark:text-gray-400">Enter the admin password to access the tools.</p>
                    <div class="flex gap-3 mt-4">
                        <input type="password" id="adminPasswordInput" class="flex-grow px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Password">
                        <button id="adminLoginBtn" class="px-4 py-2 font-semibold text-white rounded-md bg-accent hover:opacity-90">Login</button>
                    </div>
                </div>

                <!-- Admin Tools (Hidden until login) -->
                <div id="adminTools" class="hidden mt-8 space-y-8">
                    
                    <!-- Game Management -->
                    <div class="p-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">Game Management</h3>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">Add or edit games in the hub.</p>
                        
                        <div class="mt-4 space-y-3" id="gameAddForm">
                            <div>
                                <label for="gameIdInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Game ID (Optional for New)</label>
                                <input type="text" id="gameIdInput" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="e.g., retro-snake-game" readonly>
                            </div>
                            <div>
                                <label for="gameTitleInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Title*</label>
                                <input type="text" id="gameTitleInput" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Snake Game">
                            </div>
                            <div>
                                <label for="gameUrlInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">URL*</label>
                                <input type="text" id="gameUrlInput" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="https://game.link/index.html">
                            </div>
                            <div>
                                <label for="gameDescriptionInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Description</label>
                                <textarea id="gameDescriptionInput" rows="3" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="A classic arcade game..."></textarea>
                            </div>
                            <div>
                                <label for="gameTagsInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Tags (comma separated)</label>
                                <input type="text" id="gameTagsInput" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="arcade, retro, puzzle">
                            </div>
                            <div>
                                <label for="gameSectionInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Section*</label>
                                <select id="gameSectionInput" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option value="popular">Popular</option>
                                    <option value="new">New</option>
                                    <option value="action">Action</option>
                                    <option value="puzzle">Puzzle</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex justify-end mt-6 space-x-3">
                            <button id="clearFormBtn" class="px-4 py-2 font-semibold text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500">Clear Form</button>
                            <button id="saveGameBtn" class="px-4 py-2 font-semibold text-white rounded-md bg-accent hover:opacity-90">Save Game</button>
                        </div>

                        <div class="mt-6 border-t border-gray-200 dark:border-gray-700 pt-6">
                            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Existing Games</h4>
                            <div class="mt-4 flex flex-col space-y-2 max-h-96 overflow-y-auto" id="existingGamesList">
                                <!-- Existing games will be loaded here for editing/deletion -->
                            </div>
                        </div>
                    </div>

                    <!-- Data Management -->
                    <div class="p-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">Data Management</h3>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">Export and import all hub data (games, settings, stats).</p>
                        <div class="flex gap-3 mt-4">
                            <button id="exportDataBtn" class="px-4 py-2 font-semibold text-white bg-green-600 rounded-md hover:bg-green-700">Export Data (JSON)</button>
                            <button id="importDataBtn" class="px-4 py-2 font-semibold text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Import Data</button>
                            <input type="file" id="importFileInput" class="hidden" accept=".json">
                        </div>
                    </div>
                </div>
            </section>

            <!-- NEW: Game Modal -->
            <div id="gameModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-75 backdrop-blur-sm">
                <div class="flex flex-col h-full mx-auto max-w-7xl">
                    <!-- Modal Header -->
                    <div class="flex items-center justify-between p-4 bg-gray-800 text-white shadow-lg">
                        <h2 id="modalGameTitle" class="text-xl font-bold truncate">Game Title</h2>
                        <div class="flex items-center space-x-3">
                            <button id="modalNewWindowBtn" title="Open in New Window" class="p-2 rounded-full hover:bg-gray-700">
                                <i data-lucide="external-link" class="w-6 h-6"></i>
                            </button>
                            <button id="modalCloseBtn" title="Close" class="p-2 rounded-full hover:bg-gray-700">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                    <!-- Game Iframe/Content -->
                    <div class="flex-grow p-0">
                        <!-- The iframe will be inserted here -->
                        <iframe id="gameIframe" src="" frameborder="0" allowfullscreen class="w-full h-full bg-black"></iframe>
                    </div>
                    <!-- Footer with controls/info -->
                    <div class="flex items-center justify-between p-2 bg-gray-800 text-white text-sm">
                        <div id="modalGameInfo" class="flex-grow">
                            <!-- Info like tags, section, etc. -->
                        </div>
                         <!-- Interaction Buttons -->
                         <div class="flex space-x-2">
                             <button id="modalLikeBtn" title="Like Game" class="flex items-center p-2 rounded-full text-green-400 hover:bg-gray-700">
                                <i data-lucide="thumbs-up" class="w-5 h-5"></i>
                                <span id="likeCount" class="ml-1">0</span>
                             </button>
                             <button id="modalDislikeBtn" title="Dislike Game" class="flex items-center p-2 rounded-full text-red-400 hover:bg-gray-700">
                                <i data-lucide="thumbs-down" class="w-5 h-5"></i>
                                <span id="dislikeCount" class="ml-1">0</span>
                             </button>
                             <button id="modalFavoriteBtn" title="Add to Favorites" class="p-2 rounded-full text-yellow-400 hover:bg-gray-700">
                                <i data-lucide="star" class="w-5 h-5"></i>
                             </button>
                             <button id="modalNoteBtn" title="Add Note" class="p-2 rounded-full text-blue-400 hover:bg-gray-700">
                                <i data-lucide="notebook-text" class="w-5 h-5"></i>
                             </button>
                             <button id="modalReportBtn" title="Report Game" class="p-2 rounded-full text-red-400 hover:bg-gray-700">
                                <i data-lucide="flag" class="w-5 h-5"></i>
                             </button>
                         </div>
                    </div>
                </div>
            </div>

            <!-- Custom Alert/Confirm Modal Container -->
            <div id="customModalContainer" class="fixed inset-0 z-50 flex items-center justify-center hidden p-4 bg-black bg-opacity-50 backdrop-blur-sm">
                <!-- Modal content will be injected here -->
            </div>
            
            <!-- User Profile Modal -->
            <div id="userProfileModal" class="fixed inset-0 z-50 hidden p-4 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center">
                <div class="w-full max-w-xl p-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">My Profile</h3>
                    
                    <!-- Nickname -->
                    <div class="mt-4">
                        <label for="userNicknameInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nickname</label>
                        <input type="text" id="userNicknameInput" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-accent focus:border-accent sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Player">
                    </div>

                    <!-- Avatar -->
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Choose an Avatar</label>
                        <div id="userAvatarGrid" class="grid grid-cols-8 gap-2 mt-2">
                            <!-- Avatars injected by JS -->
                        </div>
                    </div>

                    <div class="flex justify-end mt-6">
                        <button id="userProfileSaveBtn" class="px-4 py-2 font-semibold text-white rounded-md bg-accent hover:opacity-90">Save</button>
                        <button id="userProfileCancelBtn" class="px-4 py-2 ml-3 font-semibold text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Global Settings Modal -->
            <div id="settingsModal" class="fixed inset-0 z-50 hidden p-4 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center">
                <div class="w-full max-w-xl p-6 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Global Settings</h3>
                    
                    <!-- Panic Button Section -->
                    <div class="mt-4 border-b border-gray-200 dark:border-gray-700 pb-4">
                        <h4 class="text-md font-semibold text-gray-800 dark:text-gray-200 flex items-center justify-between">
                            Panic Button (Cloaking)
                            <span id="cloakedStatus" class="text-sm font-medium px-2 py-1 rounded-full bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300">Uncloaked</span>
                        </h4>
                        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">Instantly cloak the site to look like a different website (e.g., Google Drive or Khan Academy).</p>
                        <div class="mt-3 space-y-2">
                            <div>
                                <label for="cloakTitleInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">New Tab Title</label>
                                <input type="text" id="cloakTitleInput" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="Google Drive">
                            </div>
                            <div>
                                <label for="cloakFaviconInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">New Favicon (Emoji or URL)</label>
                                <input type="text" id="cloakFaviconInput" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="ðŸ“š or https://example.com/icon.png">
                            </div>
                            <button id="saveCloakSettingsBtn" class="w-full px-4 py-2 font-semibold text-white rounded-md bg-accent hover:opacity-90">Save Cloak Settings</button>
                        </div>
                    </div>
                    
                    <!-- Theme Color Section -->
                    <div class="mt-4 border-b border-gray-200 dark:border-gray-700 pb-4">
                        <h4 class="text-md font-semibold text-gray-800 dark:text-gray-200">Accent Color</h4>
                        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">Choose the main color for buttons and highlights.</p>
                        <div id="colorPalette" class="flex flex-wrap gap-3 mt-3">
                            <!-- Color circles will be injected here by JS -->
                        </div>
                    </div>

                    <!-- Hub Description Section (Admin/Advanced) -->
                    <div class="mt-4">
                        <h4 class="text-md font-semibold text-gray-800 dark:text-gray-200">Hub Description</h4>
                        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">Change the main description on the home page.</p>
                        <textarea id="hubDescriptionInput" rows="3" class="block w-full px-3 py-2 mt-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white" placeholder="A collection of unblocked games..."></textarea>
                    </div>

                    <div class="flex justify-end mt-6">
                        <button id="settingsSaveBtn" class="px-4 py-2 font-semibold text-white rounded-md bg-accent hover:opacity-90">Close Settings</button>
                    </div>
                </div>
            </div>

        </main>
    
        <!-- Footer -->
        <footer class="mt-12 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
            <div class="container py-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
                <div class="flex flex-col items-center justify-between gap-2 md:flex-row">
                    <p class="text-sm text-gray-500 dark:text-gray-400">&copy; 2024 Unblocked Game Hub. All rights reserved.</p>
                    <div class="flex items-center space-x-4">
                        <button id="panicButton" title="Panic Button / Cloak" class="flex items-center p-2 text-white font-semibold bg-red-600 rounded-lg shadow-lg hover:bg-red-700 transition duration-150">
                            <i data-lucide="shield-alert" class="w-5 h-5 mr-2"></i>
                            PANIC
                        </button>
                        <button id="settingsButton" title="Settings" class="p-2 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i data-lucide="settings" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <!-- Load Firebase/App Script -->
    <script src="app.js"></script>
    <script>
        // Initialize Lucide Icons after DOM is loaded and before app.js runs (if possible)
        // This is necessary because app.js might inject new elements with icons.
        document.addEventListener('DOMContentLoaded', () => {
             // Defer icon replacement slightly to ensure app.js has a chance to inject initial components
             setTimeout(() => {
                 lucide.createIcons();
             }, 100);
        });
    </script>
</body>
</html>
