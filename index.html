<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unblocked Game Hub</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* style.css - Combined styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate-900 */
            color: #f8fafc; /* Slate-50 */
        }

        /* Custom scrollbar for game list */
        #gameListContainer {
            max-height: 80vh;
            overflow-y: auto;
            /* Simple custom scrollbar for dark mode aesthetics */
            scrollbar-color: #334155 #1e293b;
            scrollbar-width: thin;
        }

        .game-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* small helper */
        .tab-button.active {
            border-bottom: 2px solid #7c3aed; /* indigo-400 */
            color: #7c3aed;
            font-weight: 600;
        }

        /* message box */
        #messageBox.hidden { display: none; }
        #messageBox { display: flex; }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold tracking-tight text-indigo-400">Unblocked Game Hub</h1>
            <p class="text-slate-400 mt-2">Find and play your favorite unblocked games.</p>
        </header>

        <!-- Tab Navigation -->
        <div class="flex justify-center border-b border-slate-700 mb-6 sticky top-0 bg-slate-900 z-10 pt-2">
            <button id="tabGameList" data-tab="gameListView" class="tab-button active px-4 py-2 transition duration-150 ease-in-out hover:text-indigo-300">
                Game List
            </button>
            <button id="tabAdmin" data-tab="adminView" class="tab-button px-4 py-2 transition duration-150 ease-in-out hover:text-indigo-300">
                Admin Panel
            </button>
        </div>

        <!-- Game List View -->
        <div id="gameListView" class="tab-content">
            <input type="text" id="gameFilterInput" placeholder="Filter games..."
                   class="w-full p-3 mb-6 bg-slate-800 border border-slate-700 rounded-lg text-slate-100 placeholder-slate-500 focus:ring-indigo-500 focus:border-indigo-500">

            <p id="loadingMessage" class="text-center text-slate-400">Loading game data...</p>

            <div id="gameListContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Game cards will be inserted here by script.js -->
            </div>
        </div>

        <!-- Admin View (Admin.html content integrated here) -->
        <div id="adminView" class="tab-content hidden">
            <div id="loginArea" class="max-w-md mx-auto bg-slate-800 p-6 rounded-xl shadow-2xl">
                <h2 class="text-xl font-semibold text-slate-100 mb-4">Admin Login</h2>
                <input id="adminPassword" type="password" placeholder="Admin Password"
                       class="w-full p-3 mb-4 bg-slate-700 border border-slate-600 rounded-lg text-slate-100">
                <div class="flex space-x-4">
                    <button id="adminLoginBtn" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition duration-150">Login</button>
                    <button id="backBtn" class="w-full py-3 bg-slate-600 hover:bg-slate-700 text-white font-bold rounded-lg transition duration-150">Back to Games</button>
                </div>
                <p id="loginMessage" class="text-center mt-4 text-red-400"></p>
            </div>

            <div id="adminPanel" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Game Management -->
                    <div class="lg:col-span-2 bg-slate-800 p-6 rounded-xl shadow-2xl">
                        <h2 class="text-2xl font-bold text-indigo-400 mb-4">Game Management</h2>
                        <div class="mb-4">
                            <label for="editGameSelector" class="block text-slate-300 mb-2">Select Game to Edit/Delete:</label>
                            <select id="editGameSelector" class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-slate-100">
                                <option value="">-- New Game --</option>
                            </select>
                        </div>

                        <form id="gameForm" class="space-y-4">
                            <p id="adminMessage" class="text-yellow-400 font-semibold">Creating a new game.</p>
                            <div>
                                <label for="gameIdInput" class="block text-slate-300 mb-1">Game ID (must be unique, lowercase, hyphens):</label>
                                <input type="text" id="gameIdInput" required placeholder="e.g. flappy-bird"
                                       class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-slate-100" />
                            </div>
                            <div>
                                <label for="gameNameInput" class="block text-slate-300 mb-1">Name:</label>
                                <input type="text" id="gameNameInput" required placeholder="Flappy Bird Clone"
                                       class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-slate-100" />
                            </div>
                            <div>
                                <label for="gameLinkInput" class="block text-slate-300 mb-1">External Link (URL):</label>
                                <input type="url" id="gameLinkInput" placeholder="https://gameurl.com/"
                                       class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-slate-100" />
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="gameVisibleInput" checked
                                       class="h-4 w-4 text-indigo-600 bg-slate-700 border-slate-600 rounded focus:ring-indigo-500" />
                                <label for="gameVisibleInput" class="ml-2 text-slate-300">Visible to Public</label>
                            </div>

                            <div class="flex space-x-4 pt-4">
                                <button type="submit" class="flex-1 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition duration-150">Save/Update Game</button>
                                <button type="button" id="deleteGameBtn" class="py-3 px-6 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition duration-150">Delete</button>
                            </div>
                            <button type="button" id="logoutBtn" class="w-full mt-4 py-2 bg-slate-600 hover:bg-slate-700 text-white font-bold rounded-lg transition duration-150">Logout</button>
                        </form>
                    </div>

                    <!-- Statistics Summary -->
                    <div class="lg:col-span-1 space-y-6">
                        <div id="statsSummary" class="bg-slate-800 p-6 rounded-xl shadow-2xl">
                            <h2 class="text-2xl font-bold text-indigo-400 mb-4">Stats Summary</h2>
                            <!-- Stats will be rendered here -->
                        </div>
                        <div id="recentClicks" class="bg-slate-800 p-6 rounded-xl shadow-2xl">
                            <h2 class="text-2xl font-bold text-indigo-400 mb-4">Recent Clicks</h2>
                            <!-- Recent clicks will be rendered here -->
                        </div>
                        <div class="bg-slate-800 p-6 rounded-xl shadow-2xl">
                            <h2 class="text-2xl font-bold text-red-400 mb-4">Danger Zone</h2>
                            <p class="text-slate-400 mb-4">This will clear all game click statistics.</p>
                            <button id="resetStatsBtn" class="w-full py-3 bg-red-700 hover:bg-red-800 text-white font-bold rounded-lg transition duration-150">Reset Statistics</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <!-- The message box/alert replacement -->
    <div id="messageBox" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition duration-300 scale-95 opacity-0" id="messageInner">
            <h4 id="messageTitle" class="text-lg font-bold text-gray-800 mb-2"></h4>
            <p id="messageContent" class="text-gray-600 mb-4"></p>
            <button id="messageCloseBtn" class="w-full py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-150">
                Close
            </button>
        </div>
    </div>

    <script>
        /* script.js - LocalStorage version (no backend)
           Admin password: 2025
           Keeps the same UI behavior as original Apps Script version.
        */

        // ---------- Global State ----------
        const STORAGE_KEY = 'unblockhub_data';
        let DATA = null;
        let allGames = {};
        let stats = { counts: {}, recent: [] };
        const ADMIN_PASSWORD = '2025'; // Default admin password

        // FIX: Reliable placeholder image URL, replacing the missing 'assets/default.png'
        const PLACEHOLDER_IMG_URL = 'https://placehold.co/400x300/1e293b/94a3b8?text=GAME';

        // ---------- LocalStorage helpers ----------

        /** Loads all data from localStorage, or initializes default data. */
        function loadData() {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) {
                const defaultData = {
                    games: {
                        'flappy-bird': { id: 'flappy-bird', name: 'Flappy Bird Clone', link: 'https://flappybird.io/', visible: true },
                        'snake-game': { id: 'snake-game', name: 'Classic Snake', link: 'https://playsnake.org/', visible: true },
                        'tetris': { id: 'tetris', name: 'Simple Tetris', link: 'https://tetris.com/play-tetris/', visible: true }
                    },
                    stats: { counts: {}, recent: [] },
                    admin_password: ADMIN_PASSWORD // Use a constant, but this will be overridden by the form on first run
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultData));
                return defaultData;
            }
            try {
                return JSON.parse(raw);
            } catch (e) {
                console.error('Failed to parse storage, resetting', e);
                localStorage.removeItem(STORAGE_KEY);
                return loadData(); // Reload default data
            }
        }

        /** Saves the global DATA object to localStorage. */
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA));
        }

        /** Retrieves the games object. */
        function getGamesObj() {
            return (DATA && DATA.games) ? DATA.games : {};
        }

        /** Sets the games object and triggers a save. */
        function setGamesObj(obj) {
            DATA.games = obj;
            saveData();
            // Re-render UI elements that depend on games
            renderAdminOptions();
            renderGameList();
        }

        /** Retrieves the stats object. */
        function getStatsObj() {
            return (DATA && DATA.stats) ? DATA.stats : { counts: {}, recent: [] };
        }

        /** Sets the stats object and triggers a save. */
        function setStatsObj(obj) {
            DATA.stats = obj;
            saveData();
            // Re-render UI elements that depend on stats
            if (requireAdmin()) {
                renderStatsSummary();
                renderRecentClicks();
            }
        }

        // ---------- UI / Rendering Functions ----------

        /** Shows a custom message box instead of alert(). */
        function showMessage(title, content) {
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageContent').textContent = content;
            const box = document.getElementById('messageBox');
            const inner = document.getElementById('messageInner');

            // Show box first
            box.classList.remove('hidden');

            // Animate in
            setTimeout(() => {
                inner.classList.remove('scale-95', 'opacity-0');
                inner.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        /** Renders the game list based on the filter input. */
        function renderGameList() {
            const container = document.getElementById('gameListContainer');
            if (!container) return; // Guard against running before DOM is ready

            const filterText = document.getElementById('gameFilterInput').value.toLowerCase();
            const games = Object.values(getGamesObj())
                .filter(g => g.visible !== false)
                .filter(g => g.name.toLowerCase().includes(filterText) || g.id.toLowerCase().includes(filterText))
                .sort((a, b) => b.count - a.count); // Sort by popularity

            let html = '';

            if (games.length === 0) {
                html = '<p class="text-center col-span-full text-slate-500 mt-8">No games found matching your filter.</p>';
            } else {
                games.forEach(game => {
                    const clickCount = stats.counts[game.id] || 0;
                    // FIX: Use placeholder URL
                    const imgUrl = PLACEHOLDER_IMG_URL;

                    html += `
                        <div id="game-card-${game.id}" class="game-card bg-slate-800 p-4 rounded-xl shadow-lg hover:bg-slate-700 transition duration-300 cursor-pointer" onclick="launchGame('${game.id}')">
                            <img src="${imgUrl}" onerror="this.onerror=null;this.src='${PLACEHOLDER_IMG_URL}'" alt="${game.name}" class="w-full h-32 object-cover rounded-lg mb-4 border border-slate-600">
                            <h3 class="text-xl font-semibold text-slate-100 truncate">${game.name}</h3>
                            <p class="text-sm text-indigo-400 mt-1">${clickCount.toLocaleString()} plays</p>
                            <p class="text-xs text-slate-500 mt-2">${game.link ? new URL(game.link).hostname : 'No Link'}</p>
                        </div>
                    `;
                });
            }

            container.innerHTML = html;
        }

        /** Logs a game click and updates stats. */
        function logClick(gameId) {
            const currentStats = getStatsObj();

            // 1. Update counts
            currentStats.counts[gameId] = (currentStats.counts[gameId] || 0) + 1;

            // 2. Update recent clicks (max 10)
            currentStats.recent.unshift({
                gameId: gameId,
                timestamp: new Date().toISOString()
            });
            currentStats.recent = currentStats.recent.slice(0, 10);

            // 3. Update global stats and save
            setStatsObj(currentStats);
        }

        /**
         * FIX: Modified to open in new tab to avoid X-Frame-Options blocks.
         * Launches a game by opening its link in a new tab and logging the click.
         */
        function launchGame(gameId) {
            const game = getGamesObj()[gameId];
            if (!game || !game.link) {
                showMessage('Error', 'Game link is missing or invalid.');
                return;
            }

            logClick(gameId);
            // FIX: Open in new tab because most sites block embedding via X-Frame-Options.
            window.open(game.link, '_blank');
            showMessage('Game Launched', `The game '${game.name}' has been opened in a new tab. Note: Embedding is often blocked by game providers.`);
        }


        // ---------- Admin Functions ----------

        /** Renders the game selector dropdown in the admin panel. */
        function renderAdminOptions() {
            const selector = document.getElementById('editGameSelector');
            if (!selector) return;

            const games = getGamesObj();
            let optionsHtml = '<option value="">-- New Game --</option>';

            Object.keys(games).sort().forEach(id => {
                const game = games[id];
                optionsHtml += `<option value="${id}">${game.name} (${game.id})</option>`;
            });

            selector.innerHTML = optionsHtml;
        }

        /** Renders the statistics summary (total games, total clicks). */
        function renderStatsSummary() {
            const container = document.getElementById('statsSummary');
            if (!container || !requireAdmin()) return;

            const games = getGamesObj();
            const counts = stats.counts;
            const totalGames = Object.keys(games).length;
            const totalClicks = Object.values(counts).reduce((sum, count) => sum + count, 0);

            let html = `
                <h2 class="text-2xl font-bold text-indigo-400 mb-4">Stats Summary</h2>
                <div class="space-y-2">
                    <p class="text-slate-300">Total Games: <span class="font-bold text-white">${totalGames}</span></p>
                    <p class="text-slate-300">Total Clicks: <span class="font-bold text-white">${totalClicks.toLocaleString()}</span></p>
                </div>
                <div class="mt-4">
                    <h3 class="text-lg font-semibold text-slate-300 mb-2">Top 3 Games:</h3>
                    <ol class="list-inside list-decimal text-slate-400 space-y-1">
                        ${Object.keys(counts)
                            .map(id => ({ id, count: counts[id] }))
                            .sort((a, b) => b.count - a.count)
                            .slice(0, 3)
                            .map(item => `<li>${games[item.id] ? games[item.id].name : item.id} (${item.count.toLocaleString()})</li>`)
                            .join('')}
                    </ol>
                </div>
            `;
            container.innerHTML = html;
        }

        /** Renders the list of recent clicks. */
        function renderRecentClicks() {
            const container = document.getElementById('recentClicks');
            if (!container || !requireAdmin()) return;

            const recent = stats.recent || [];
            const games = getGamesObj();

            let listHtml = '<ul class="text-sm space-y-2">';

            if (recent.length === 0) {
                listHtml += '<li class="text-slate-500">No recent clicks recorded.</li>';
            } else {
                recent.forEach(click => {
                    const game = games[click.gameId];
                    const gameName = game ? game.name : `[Deleted Game: ${click.gameId}]`;
                    const time = new Date(click.timestamp).toLocaleTimeString();
                    listHtml += `<li class="border-b border-slate-700 pb-1 last:border-b-0"><span class="font-medium text-slate-200">${time}</span> - ${gameName}</li>`;
                });
            }
            listHtml += '</ul>';

            container.innerHTML = `<h2 class="text-2xl font-bold text-indigo-400 mb-4">Recent Clicks</h2>${listHtml}`;
        }

        /** Adds or updates a game. */
        function upsertGame(gameData) {
            const games = getGamesObj();
            games[gameData.id] = gameData;
            setGamesObj(games);
            showMessage('Success', `Game "${gameData.name}" has been saved/updated.`);
        }

        /** Deletes a game. */
        function deleteGame(gameId) {
            const games = getGamesObj();
            const gameName = games[gameId] ? games[gameId].name : 'Unknown Game';
            delete games[gameId];
            setGamesObj(games);
            // Clear form after deletion
            clearGameForm();
            showMessage('Deleted', `Game "${gameName}" (${gameId}) has been deleted.`);
        }

        /** Clears the game form in the admin panel. */
        function clearGameForm() {
            document.getElementById('editGameSelector').value = '';
            document.getElementById('gameIdInput').value = '';
            document.getElementById('gameNameInput').value = '';
            document.getElementById('gameLinkInput').value = '';
            document.getElementById('gameVisibleInput').checked = true;
            document.getElementById('adminMessage').textContent = 'Creating a new game.';
        }

        /** Resets all click statistics. */
        function resetStats() {
            const newStats = { counts: {}, recent: [] };
            setStatsObj(newStats);
            showMessage('Stats Reset', 'All game click statistics have been cleared.');
        }

        // ---------- Admin Validation / Protection ----------
        function requireAdmin() {
            return localStorage.getItem('adminLoggedIn') === 'true';
        }

        function showAdminPanel() {
            document.getElementById('loginArea').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            // load data into UI
            renderAdminOptions();
            renderStatsSummary();
            renderRecentClicks();
            // Ensure form is cleared/ready
            clearGameForm();
        }

        function hideAdminPanel() {
            document.getElementById('loginArea').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            localStorage.removeItem('adminLoggedIn');
        }

        // ---------- Initial Load and Event Setup ----------

        /** Initializes global data and renders all necessary components. */
        function loadAll() {
            // 1. Refresh state from DATA
            DATA = loadData();
            allGames = DATA.games || {};
            stats = DATA.stats || { counts: {}, recent: [] };

            // 2. Hide loading message
            const loadingMessageEl = document.getElementById('loadingMessage');
            if (loadingMessageEl) loadingMessageEl.classList.add('hidden');

            // 3. Render initial views
            renderAll();
        }

        /** Renders all UI components that depend on data. */
        function renderAll() {
            renderGameList();
            // Check admin state and render admin views if necessary
            if (requireAdmin()) {
                showAdminPanel();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Load initial data
            loadAll();

            // --- Tab Switching Logic (Combined index.html/admin.html) ---
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            function switchTab(targetId) {
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                });

                document.getElementById(targetId).classList.remove('hidden');
                document.querySelector(`[data-tab="${targetId}"]`).classList.add('active');

                // Special logic for Admin tab
                if (targetId === 'adminView' && requireAdmin()) {
                    showAdminPanel();
                } else if (targetId === 'adminView') {
                    // Show login form if not logged in
                    document.getElementById('loginArea').classList.remove('hidden');
                    document.getElementById('adminPanel').classList.add('hidden');
                }
            }

            tabButtons.forEach(btn => {
                btn.onclick = () => switchTab(btn.dataset.tab);
            });

            // --- Global UI Listeners ---

            // Close message box
            document.getElementById('messageCloseBtn').onclick = () => {
                const inner = document.getElementById('messageInner');
                inner.classList.remove('scale-100', 'opacity-100');
                inner.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    document.getElementById('messageBox').classList.add('hidden');
                }, 300); // Wait for transition to finish
            };

            // Game filtering
            document.getElementById('gameFilterInput').oninput = renderGameList;

            // --- Admin Listeners ---

            // Admin Login
            document.getElementById('adminLoginBtn').onclick = () => {
                const password = document.getElementById('adminPassword').value;
                const loginMessage = document.getElementById('loginMessage');
                if (password === ADMIN_PASSWORD) {
                    localStorage.setItem('adminLoggedIn', 'true');
                    loginMessage.textContent = 'Login successful!';
                    document.getElementById('adminPassword').value = '';
                    setTimeout(() => {
                        showAdminPanel();
                        loginMessage.textContent = '';
                    }, 500);
                } else {
                    loginMessage.textContent = 'Invalid password.';
                }
            };

            // Back button (from login screen)
            document.getElementById('backBtn').onclick = () => {
                switchTab('gameListView');
            };

            // Logout button
            document.getElementById('logoutBtn').onclick = () => {
                hideAdminPanel();
                switchTab('gameListView');
                showMessage('Logged Out', 'You have been logged out of the Admin Panel.');
            };

            // Game Selector Change (in admin panel)
            document.getElementById('editGameSelector').onchange = (e) => {
                const id = e.target.value;
                const games = getGamesObj();
                if (id && games[id]) {
                    const g = games[id];
                    document.getElementById('gameIdInput').value = g.id;
                    document.getElementById('gameNameInput').value = g.name;
                    document.getElementById('gameLinkInput').value = g.link || '';
                    document.getElementById('gameVisibleInput').checked = g.visible !== false;
                    document.getElementById('adminMessage').textContent = 'Editing existing game.';
                } else {
                    clearGameForm();
                }
            };

            // Game Form Submission (Save/Update)
            document.getElementById('gameForm').onsubmit = (e) => {
                e.preventDefault();
                if (!requireAdmin()) {
                    showMessage('Error', 'Unauthorized action.');
                    return;
                }

                const gameId = document.getElementById('gameIdInput').value.trim();
                const gameName = document.getElementById('gameNameInput').value.trim();
                const gameLink = document.getElementById('gameLinkInput').value.trim();
                const isVisible = document.getElementById('gameVisibleInput').checked;

                if (!gameId || !gameName) {
                    showMessage('Error', 'Game ID and Name are required.');
                    return;
                }

                const newGame = {
                    id: gameId,
                    name: gameName,
                    link: gameLink,
                    visible: isVisible
                };

                upsertGame(newGame);
            };

            // Delete Game Button
            document.getElementById('deleteGameBtn').onclick = () => {
                if (!requireAdmin()) {
                    showMessage('Error', 'Unauthorized action.');
                    return;
                }
                const gameId = document.getElementById('gameIdInput').value.trim();
                if (!gameId) {
                    showMessage('Error', 'Please select a game to delete.');
                    return;
                }
                // Use a custom confirm dialog replacement
                showMessage('Confirm Deletion', `Are you sure you want to delete the game with ID: ${gameId}?`);
                // Modify the close button temporarily for confirmation action
                const closeBtn = document.getElementById('messageCloseBtn');
                const originalOnClick = closeBtn.onclick;

                closeBtn.textContent = 'CANCEL';
                closeBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                closeBtn.classList.add('bg-slate-500', 'hover:bg-slate-600');

                // Create a second button for the confirm action
                const confirmBtn = document.createElement('button');
                confirmBtn.textContent = 'DELETE';
                confirmBtn.className = 'w-full py-2 mb-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-150';
                confirmBtn.onclick = () => {
                    deleteGame(gameId);
                    // Restore original state
                    originalOnClick();
                    closeBtn.textContent = 'Close';
                    closeBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    closeBtn.classList.remove('bg-slate-500', 'hover:bg-slate-600');
                    closeBtn.onclick = originalOnClick;
                    confirmBtn.remove();
                };

                document.getElementById('messageInner').insertBefore(confirmBtn, closeBtn);

                // Restore original close button behavior if cancelled
                closeBtn.onclick = () => {
                    originalOnClick();
                    closeBtn.textContent = 'Close';
                    closeBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    closeBtn.classList.remove('bg-slate-500', 'hover:bg-slate-600');
                    closeBtn.onclick = originalOnClick;
                    confirmBtn.remove();
                };
            };

            // Reset Stats Button
            document.getElementById('resetStatsBtn').onclick = () => {
                if (!requireAdmin()) {
                    showMessage('Error', 'Unauthorized action.');
                    return;
                }
                resetStats();
            };

            // Ensure all globally needed functions are exposed
            window.launchGame = launchGame;
            window.logClick = logClick;
        });
    </script>
</body>
</html>
